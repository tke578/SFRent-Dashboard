<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Sfrent Dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="custom_css/custom_css.css">
		<link rel="stylesheet" type="text/css" href="bootstrap_3.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="font-awesome-4.0.3/css/font-awesome.min.css">
		<link rel="shortcut icon" href="sfrent.ico">
	</head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js" type="text/javascript"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
	<body>
		<h2 style="text-align:center; margin-top:0px;">
			<span class="glyphicon glyphicon-home" style="height:30px;"></span> Vacant
		</h2>
		<div class="page"></div>
	</div>
		<script type="text/template"id="user-list-template">
		<section style="margin-top:80px;" width="100%" id="table-section">
			<table width="100%"class="table-header-rotated" style="margin-top:-85px; margin-left:0px;">
			    <thead>
			      	<tr> 
				        <th width="1%"></th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:10px; bottom:42px;">Building</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:0px; bottom:30px;">Unit #</span>
							</div>
						</th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:25px; bottom:15px;">Type of Unit</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:-25px; bottom:30px;">Size</span>
							</div>
						</th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:-5px; bottom:25px;">Rent</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:-15px; bottom:20px;">Prev. Rent</span>
							</div>
						</th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:-15px; bottom:25px;">Diff.</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:-25px; bottom:40px;">Photos</span>
							</div>
						</th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:-5px; bottom:25px;">Vacancy Date</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:-15px; bottom:30px;">RTR</span>
							</div>
						</th>
						<th class="rotate-45">
							<div style="background-color: rgb(15,15,15);">
								<span style="left:40px; bottom:40px;">Status</span>
							</div>
						</th>
						<th class="rotate-45">
							<div>
								<span style="left:-15px; bottom:25px;">Move in date</span>
							</div>
						</th>
			      	</tr>
			    </thead>
			    <tbody>
				    <% _.each(users, function(user, i) { %>
					    <tr class="highligted-row <%= user.get('short_name') %>">
					    	<th></th>
					        <td>
					       		<button type="button" class="btn btn-primary btn-lg btn-bldg">
					        		<strong><%= user.get('short_name') %></strong>
					        	</button>
					        </td>
					        <td>
					        	<%= user.get('unit_number') %>
					        </td>
					        <td>
					        	<%= user.get('building_apartment_size') %>
					        </td>
					        <td>
					        	<%= user.get('dimension') == null ? "N/A" : Math.round(user.get('dimension')) %>
					        </td>
					        <td>
					        	<strong class="color-green"><%= Math.round(user.get('rent')) %></strong>
					        </td>
					        <td>
					        	<strong style="color: rgb(133, 123, 123);"><%= Math.round(user.get('prev_rent')) %></strong>
					        </td>
					        <td>
					        	<% if(Math.round(user.get('rent') - user.get('prev_rent')) >=0) { %>
					        		<strong style="color: rgb(30, 228, 78);"><%= Math.round(user.get('rent') - user.get('prev_rent')) %></strong>
					        	<% } else { %>
					        	 	<strong style="color: rgb(253, 24, 24)"><%= Math.round(user.get('rent') - user.get('prev_rent')) %></strong>
					        	<% } %>
					        </td>
					        <td>
					        	<% if(user.get('active_building_apartment_photos') == 0) { %>
					        		<button type="button" class="btn btn-danger btn-lg"><%= user.get('active_building_apartment_photos') %></button>
					        	<% } else if(user.get('active_building_apartment_photos') > 0 && user.get('active_building_apartment_photos') < 4) { %>
					        		<button type="button" class="btn btn-warning btn-lg"><%= user.get('active_building_apartment_photos') %></button>
					        	<% } else { %>
					        		<button type="button" class="btn btn-success btn-lg"><%= user.get('active_building_apartment_photos') %></button>
					        	<% } %>
					        </td>
					        <td>
					        	<% if(user.get('estimated_move_out_date').length == 0) { %>
					        		<button type="button" class="btn btn-danger btn-lg"><i class="fa fa-exclamation-triangle"></i> N/A</button>
					        	<% } else { %>
					        		<button type="button" class="btn btn-opaque btn-lg"><%= user.get('estimated_move_out_date').slice(6,9) + user.get('estimated_move_out_date').slice(9,11) %></button>
					        	<% } %>
					        </td>
					        <td>
					        	<% if(user.get('move_out_requested_date').length == 0) { %>
					        		<button type="button" class="btn btn-danger btn-lg"><i class="fa fa-exclamation-triangle"></i> N/A</button>
					        	<% } else { %>
					        		<button	type="button" class="btn btn-opaque btn-lg"><%= user.get('move_out_requested_date').slice(6,9) + user.get('move_out_requested_date').slice(9,11) %></button>
					        	<% } %>
					        </td>
					        <td>
					        	<button type="button" class="btn btn-success btn-lg"><i class="fa fa-check-square-o"></i> <%= user.get('move_out_status') %></button>
					        </td>
							<td>
								<%= user.get('make_ready_completed_date').length === 0 ? "N/A" : user.get('make_ready_completed_date').slice(6,9) + user.get('make_ready_completed_date').slice(9,11) + "-" +user.get('estimated_move_out_date').slice(1,5) %>
							</td>
					    </tr>
				    <% }); %>
			    </tbody>
			</table>
			<img  style="position:fixed; right:0px; bottom:15px;"src="sfrent-logo.png">
		</section>
		</script>
		<script>
			var updateInterval = 50000;

			var Users = Backbone.Collection.extend({
				url: 'https://dev.sfrent.net/api/move_outs/get_move_outs?status=pending'
			});
			var User = Backbone.Model.extend({
				url: 'https://dev.sfrent.net/api/move_outs/get_move_outs?status=pending'
			});

			var UserList = Backbone.View.extend({
				el : '.page',
				render: function()	{
					var that = this;
					var users = new Users();
					users.fetch({
						success: function(users)	{
							var template = _.template($('#user-list-template').html(),{users: users.models});
							that.$el.html(template);
						}
					})
				}
			});
			var userList = new UserList();
			//doc rdy
			$(function(){
				userList.render();

				// setInterval(function(){
				// 	userList.render();
				// },updateInterval);
			});
		</script>
	</body>
</html>